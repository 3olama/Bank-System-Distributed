package client;

import java.awt.Color;
import java.awt.Font;
import java.awt.Image;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.ResultSet;
import java.sql.SQLException;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPasswordField;

import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import rmi.BankService;

public class CheckBalance extends JFrame implements ActionListener {

	String ssn, pin;
	JLabel pinL, label, text;
	JButton checkBalance, back;
	JPasswordField pinPF;
	public CheckBalance(String ssn, String pin) 
	{
		setLayout(null);
		
		this.ssn = ssn;
		this.pin = pin;
		
		ImageIcon img1 = new ImageIcon(ClassLoader.getSystemResource("atm.jpg"));
		Image img2 = img1.getImage().getScaledInstance(900, 915, Image.SCALE_DEFAULT);
		img1 =  new ImageIcon(img2);
		label = new JLabel(img1);
		label.setBounds(0, 0, 900, 850);
		add(label);
		
		text = new JLabel("Check Balance:");
		text.setBounds(265, 265, 700, 35);
		text.setFont(new Font("System", Font.BOLD, 18));
		text.setForeground(Color.GREEN);
		label.add(text);
		
		pinL = new JLabel("Enter PIN:");
		pinL.setBounds(185, 350, 180, 25);
		pinL.setFont(new Font("System", Font.BOLD, 16));
		pinL.setForeground(Color.WHITE);
		label.add(pinL);
		
		pinPF = new JPasswordField();
		pinPF.setFont(new Font("System", Font.BOLD, 25));
		pinPF.setBounds(300, 350, 180, 25);
		label.add(pinPF);
		
		checkBalance = new JButton("GET BALANCE");
		checkBalance.setBounds(355, 465, 150, 24);
		checkBalance.addActionListener(this);
		label.add(checkBalance);
		
		back = new JButton("BACK");
		back.setBounds(355, 500, 150, 24);
		back.addActionListener(this);
		label.add(back);
		
		setSize(900, 900);
		setLocation(300, 0);
		setUndecorated(true);
		setVisible(true);
    }

    @Override
    public void actionPerformed(ActionEvent ae) {
        if (ae.getSource() == back) {
        	setVisible(false);
            new Transactions(ssn, pin).setVisible(true);
        } 
        else if (ae.getSource() == checkBalance) {
            String testpin = pinPF.getText();
            if (testpin.equals("")) {
                JOptionPane.showMessageDialog(null, "PIN is required!");
                pinPF.requestFocus();
                return;
            } else if (!testpin.equals(pin)) {
                JOptionPane.showMessageDialog(null, "Invalid PIN!");
                pinPF.setText("");
                pinPF.requestFocus();
                return;
            } else {
            try {
                // Connexion RMI au serveur
                Registry registry = LocateRegistry.getRegistry("localhost", 1099);
                BankService service = (BankService) registry.lookup("bankService");

                // Appel RMI pour récupérer le solde
                double balance = service.getBalance(ssn);

                if (balance >= 0) {
                    balanceLabel.setText("Your account balance is: $" + balance);
                } else {
                    balanceLabel.setText("Unable to retrieve balance. Please try again later.");
                }

            } catch (Exception e) {
                e.printStackTrace();
                JOptionPane.showMessageDialog(this, "Error connecting to server:\n" + e.getMessage());
            }
        }
    }

    public static void main(String[] args) {
        new CheckBalance("SSN001", "1111222233334444", "1234"); // test
    }
}
