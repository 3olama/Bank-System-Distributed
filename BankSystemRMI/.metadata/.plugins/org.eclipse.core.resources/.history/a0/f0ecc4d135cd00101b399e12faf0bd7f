package client;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;

public class SignupThree extends JFrame implements ActionListener {

    JButton submit;
    JCheckBox declarations;
    String formno, ssn;

    public SignupThree(String formno, String ssn) {
        this.formno = formno;
        this.ssn = ssn;

        setTitle("NEW ACCOUNT APPLICATION FORM - PAGE 3");
        setLayout(null);

        JLabel finalDetails = new JLabel("Page 3: Final Details");
        finalDetails.setFont(new Font("Raleway", Font.BOLD, 25));
        finalDetails.setBounds(300, 40, 400, 30);
        add(finalDetails);

        declarations = new JCheckBox("I hereby declare that the above entered details are correct to the best of my knowledge.");
        declarations.setBounds(50, 150, 800, 50);
        add(declarations);

        submit = new JButton("Submit");
        submit.setBounds(600, 600, 100, 30);
        submit.addActionListener(this);
        add(submit);

        setSize(850, 750);
        setLocation(350, 10);
        setVisible(true);
        getContentPane().setBackground(Color.WHITE);
    }

    public void actionPerformed(ActionEvent ae) {
        if(!declarations.isSelected()) {
            JOptionPane.showMessageDialog(null, "Please accept the declaration to proceed!");
            return;
        }

        try {
            String accountType = "";
            if(acc1.isSelected()) accountType = "Savings Account";
            else if(acc2.isSelected()) accountType = "Checking Account";
            else if(acc3.isSelected()) accountType = "Money Market Account";
            else if(acc4.isSelected()) accountType = "Certificate of Deposit";

            // génération cardNumber et pin comme avant
            Random random = new Random();
            String cardNumber = "" + Math.abs((random.nextLong() % 90000000L) + 8060599100000000L);
            String pin = "" + Math.abs((random.nextInt() % 9000L) + 1000L);

            String atmCard = sr1.isSelected() ? "Y" : "N";
            String chequeBook = sr2.isSelected() ? "Y" : "N";
            String internetBanking = sr3.isSelected() ? "Y" : "N";
            String mobileBanking = sr4.isSelected() ? "Y" : "N";
            String eStatement = sr5.isSelected() ? "Y" : "N";
            String emailSMS = sr6.isSelected() ? "Y" : "N";

            // Appel RMI
            BankService service = (BankService) Naming.lookup("rmi://localhost/BankService");
            boolean success = service.signupThree(ssn, accountType, cardNumber, pin, atmCard, chequeBook, internetBanking, mobileBanking, eStatement, emailSMS);

            if(success){
                JOptionPane.showMessageDialog(null, "Account created successfully!");
                setVisible(false);
                new Login();
            } else {
                JOptionPane.showMessageDialog(null, "Error while creating account!");
            }

        } catch(Exception e){
            e.printStackTrace();
        }
    }
}