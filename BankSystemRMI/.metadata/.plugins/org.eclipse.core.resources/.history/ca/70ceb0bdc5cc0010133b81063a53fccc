package client;

import javax.swing.*;
import java.awt.event.*;
import java.registry.LocateRegistry;
import java.registry.Registry;
import rmi.BankService;

public class CheckBalance extends JFrame implements ActionListener {

    JButton checkBalanceBtn;
    JLabel balanceLabel;
    String ssn, cardNumber, pin;

    public CheckBalance(String ssn, String cardNumber, String pin) {
        super("ATM Transactions");
        this.ssn = ssn;
        this.cardNumber = cardNumber;
        this.pin = pin;

        setLayout(null);
        setSize(600, 400);
        setLocationRelativeTo(null);

        checkBalanceBtn = new JButton("Check Balance");
        checkBalanceBtn.setBounds(200, 50, 200, 40);
        checkBalanceBtn.addActionListener(this);
        add(checkBalanceBtn);

        balanceLabel = new JLabel("Your balance will appear here");
        balanceLabel.setBounds(150, 120, 400, 30);
        add(balanceLabel);

        setVisible(true);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }

    @Override
    public void actionPerformed(ActionEvent ae) {
        if (ae.getSource() == checkBalanceBtn) {
            try {
                // Connexion RMI au serveur
                Registry registry = LocateRegistry.getRegistry("localhost", 1099);
                BankService service = (BankService) registry.lookup("bankService");

                // Appel RMI pour récupérer le solde
                double balance = service.getBalance(ssn);

                if (balance >= 0) {
                    balanceLabel.setText("Your account balance is: $" + balance);
                } else {
                    balanceLabel.setText("Unable to retrieve balance. Please try again later.");
                }

            } catch (Exception e) {
                e.printStackTrace();
                JOptionPane.showMessageDialog(this, "Error connecting to server:\n" + e.getMessage());
            }
        }
    }

    public static void main(String[] args) {
        new TransactionsFrame("SSN001", "1111222233334444", "1234"); // test
    }
}
